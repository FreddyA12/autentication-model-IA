<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Reconocimiento Facial</title>
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <svg width="40" height="40" viewBox="0 0 40 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="20" cy="20" r="18" stroke="currentColor" stroke-width="2"/>
                    <circle cx="15" cy="16" r="2" fill="currentColor"/>
                    <circle cx="25" cy="16" r="2" fill="currentColor"/>
                    <path d="M 14 26 Q 20 30, 26 26" stroke="currentColor" stroke-width="2" fill="none"/>
                </svg>
                <h1>Autenticaci√≥n Biom√©trica</h1>
            </div>
            <p class="subtitle">Sistema de reconocimiento facial y de voz con IA</p>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab-btn active" data-tab="face">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="1.5" fill="none"/>
                    <circle cx="9" cy="10" r="1.5" fill="currentColor"/>
                    <circle cx="15" cy="10" r="1.5" fill="currentColor"/>
                    <path d="M 8 15 Q 12 17, 16 15" stroke="currentColor" stroke-width="1.5" fill="none"/>
                </svg>
                Reconocimiento Facial
            </button>
            <button class="tab-btn" data-tab="voice">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2a3 3 0 0 0-3 3v6a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3z" fill="currentColor"/>
                    <path d="M19 10v1a7 7 0 0 1-14 0v-1M12 18v4M8 22h8" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round"/>
                </svg>
                Reconocimiento de Voz
            </button>
            <button class="tab-btn" data-tab="dual">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
                </svg>
                Autenticaci√≥n Dual
            </button>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Face Tab Content -->
            <div id="faceTab" class="tab-content active">
            <!-- Camera Section -->
            <div class="camera-section">
                <div class="camera-container" id="cameraContainer">
                    <video id="video" autoplay playsinline></video>
                    <canvas id="canvas" style="display: none;"></canvas>
                    <div id="detectedBox" class="detected-box" style="display:none; position:absolute; border:3px solid #10b981; border-radius:8px; box-shadow:0 0 12px rgba(16,185,129,0.7); pointer-events:none;"></div>
                    
                    <!-- Camera Overlay -->
                    <div class="camera-overlay">
                        <div class="face-guide">
                            <div class="corner top-left"></div>
                            <div class="corner top-right"></div>
                            <div class="corner bottom-left"></div>
                            <div class="corner bottom-right"></div>
                        </div>
                    </div>

                    <!-- Camera Status -->
                    <div class="camera-status" id="cameraStatus">
                        <span class="status-icon">üì∑</span>
                        <span class="status-text">C√°mara desactivada</span>
                    </div>
                </div>

                <!-- Camera Controls -->
                <div class="camera-controls">
                    <button id="startCamera" class="btn btn-primary">
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm12 0v10l4 2V3l-4 2z"/>
                        </svg>
                        Activar C√°mara
                    </button>
                    <button id="captureBtn" class="btn btn-success" disabled>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <circle cx="10" cy="10" r="8"/>
                        </svg>
                        Capturar y Autenticar
                    </button>
                    <button id="stopCamera" class="btn btn-secondary" disabled>
                        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                            <rect width="20" height="20" rx="2"/>
                        </svg>
                        Detener
                    </button>
                </div>
            </div>

            <!-- Results Section -->
            <div class="results-section">
                <div class="result-card" id="resultCard">
                    <div class="result-icon">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="2" opacity="0.2"/>
                            <path d="M 40 15 L 40 40 L 55 40" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h3>Esperando captura...</h3>
                    <p>Activa la c√°mara y captura una imagen para comenzar</p>
                </div>

                <!-- Loading State -->
                <div class="loading-state" id="loadingState" style="display: none;">
                    <div class="spinner"></div>
                    <p>Analizando rostro...</p>
                </div>

                <!-- Success State -->
                <div class="success-state" id="successState" style="display: none;">
                    <div class="success-icon">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="40" r="38" stroke="#10b981" stroke-width="3"/>
                            <path d="M 25 40 L 35 50 L 55 30" stroke="#10b981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                        </svg>
                    </div>
                    <h2 class="success-title">¬°Autenticado!</h2>
                    <div class="identity-info">
                        <p class="identity-name" id="identityName">-</p>
                        <div class="confidence-bar">
                            <div class="confidence-fill" id="confidenceFill"></div>
                        </div>
                        <p class="confidence-text" id="confidenceText">0%</p>
                    </div>
                </div>

                <!-- Unknown State -->
                <div class="unknown-state" id="unknownState" style="display: none;">
                    <div class="unknown-icon">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="40" r="38" stroke="#f59e0b" stroke-width="3"/>
                            <text x="40" y="55" font-size="50" text-anchor="middle" fill="#f59e0b">?</text>
                        </svg>
                    </div>
                    <h2 class="unknown-title">Persona Desconocida</h2>
                    <p class="unknown-message" id="unknownMessage">-</p>
                </div>

                <!-- Error State -->
                <div class="error-state" id="errorState" style="display: none;">
                    <div class="error-icon">
                        <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                            <circle cx="40" cy="40" r="38" stroke="#ef4444" stroke-width="3"/>
                            <path d="M 30 30 L 50 50 M 50 30 L 30 50" stroke="#ef4444" stroke-width="4" stroke-linecap="round"/>
                        </svg>
                    </div>
                    <h2 class="error-title">Error</h2>
                    <p class="error-message" id="errorMessage">-</p>
                </div>

                <!-- Probabilities -->
                <div class="probabilities" id="probabilitiesSection" style="display: none;">
                    <h4>Probabilidades:</h4>
                    <div id="probabilitiesList"></div>
                </div>
            </div>
            </div>

            <!-- Voice Tab Content -->
            <div id="voiceTab" class="tab-content">
                <!-- Voice Section -->
                <div class="voice-section">
                    <div class="voice-container">
                        <div class="voice-visualizer" id="voiceVisualizer">
                            <canvas id="waveform" width="600" height="200"></canvas>
                            <div class="mic-icon" id="micIcon">
                                <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                    <path d="M40 10a12 12 0 0 0-12 12v18a12 12 0 0 0 24 0V22a12 12 0 0 0-12-12z" fill="currentColor" opacity="0.3"/>
                                    <path d="M60 36v4a20 20 0 0 1-40 0v-4M40 60v12M28 72h24" stroke="currentColor" stroke-width="3" fill="none" stroke-linecap="round"/>
                                </svg>
                            </div>
                        </div>

                        <!-- Recording Status -->
                        <div class="recording-status" id="recordingStatus">
                            <span class="status-icon">üé§</span>
                            <span class="status-text">Listo para grabar</span>
                        </div>
                    </div>

                    <!-- Voice Controls -->
                    <div class="voice-controls">
                        <button id="startRecording" class="btn btn-primary">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <circle cx="10" cy="10" r="8"/>
                            </svg>
                            Grabar Audio (5s)
                        </button>
                        <button id="stopRecording" class="btn btn-danger" disabled style="display: none;">
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <rect width="16" height="16" x="2" y="2" rx="2"/>
                            </svg>
                            Detener
                        </button>
                        <button id="authenticateVoice" class="btn btn-success" disabled>
                            <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M9 2a1 1 0 000 2h2a1 1 0 100-2H9z"/>
                                <path fill-rule="evenodd" d="M4 5a2 2 0 012-2 3 3 0 003 3h2a3 3 0 003-3 2 2 0 012 2v11a2 2 0 01-2 2H6a2 2 0 01-2-2V5zm9.707 5.707a1 1 0 00-1.414-1.414L9 12.586l-1.293-1.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            Autenticar
                        </button>
                    </div>

                    <!-- Audio Player -->
                    <div class="audio-player" id="audioPlayer" style="display: none;">
                        <audio id="recordedAudio" controls></audio>
                    </div>
                </div>

                <!-- Voice Results Section -->
                <div class="results-section">
                    <div class="result-card" id="voiceResultCard">
                        <div class="result-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="2" opacity="0.2"/>
                                <path d="M40 20a8 8 0 0 0-8 8v12a8 8 0 0 0 16 0V28a8 8 0 0 0-8-8z" fill="currentColor" opacity="0.3"/>
                                <path d="M52 36v4a12 12 0 0 1-24 0v-4M40 52v8M32 60h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h3>Esperando grabaci√≥n...</h3>
                        <p>Graba un audio de 3 segundos para comenzar</p>
                    </div>

                    <!-- Loading State -->
                    <div class="loading-state" id="voiceLoadingState" style="display: none;">
                        <div class="spinner"></div>
                        <p>Analizando voz...</p>
                    </div>

                    <!-- Success State -->
                    <div class="success-state" id="voiceSuccessState" style="display: none;">
                        <div class="success-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="38" stroke="#10b981" stroke-width="3"/>
                                <path d="M 25 40 L 35 50 L 55 30" stroke="#10b981" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </div>
                        <h2 class="success-title">¬°Autenticado!</h2>
                        <div class="identity-info">
                            <p class="identity-name" id="voiceIdentityName">-</p>
                            <div class="confidence-bar">
                                <div class="confidence-fill" id="voiceConfidenceFill"></div>
                            </div>
                            <p class="confidence-text" id="voiceConfidenceText">0%</p>
                        </div>
                    </div>

                    <!-- Unknown State -->
                    <div class="unknown-state" id="voiceUnknownState" style="display: none;">
                        <div class="unknown-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="38" stroke="#f59e0b" stroke-width="3"/>
                                <text x="40" y="55" font-size="50" text-anchor="middle" fill="#f59e0b">?</text>
                            </svg>
                        </div>
                        <h2 class="unknown-title">Voz Desconocida</h2>
                        <p class="unknown-message" id="voiceUnknownMessage">-</p>
                    </div>

                    <!-- Error State -->
                    <div class="error-state" id="voiceErrorState" style="display: none;">
                        <div class="error-icon">
                            <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                                <circle cx="40" cy="40" r="38" stroke="#ef4444" stroke-width="3"/>
                                <path d="M 30 30 L 50 50 M 50 30 L 30 50" stroke="#ef4444" stroke-width="4" stroke-linecap="round"/>
                            </svg>
                        </div>
                        <h2 class="error-title">Error</h2>
                        <p class="error-message" id="voiceErrorMessage">-</p>
                    </div>

                    <!-- Probabilities -->
                    <div class="probabilities" id="voiceProbabilitiesSection" style="display: none;">
                        <h4>Probabilidades:</h4>
                        <div id="voiceProbabilitiesList"></div>
                    </div>
                </div>
            </div>

            <!-- Dual Tab Content -->
            <div id="dualTab" class="tab-content">
                <div class="dual-section">
                    <div class="dual-container" style="display: flex; flex-direction: column; align-items: center; gap: 20px;">
                        
                        <!-- Video -->
                        <div class="camera-container" style="position: relative; width: 100%; max-width: 640px;">
                            <video id="dualVideo" autoplay playsinline style="width: 100%; border-radius: 12px;"></video>
                            <canvas id="dualCanvas" style="display: none;"></canvas>
                        </div>

                        <!-- Audio Visualizer -->
                        <div class="voice-visualizer" style="width: 100%; max-width: 640px; height: 100px; background: rgba(0,0,0,0.2); border-radius: 12px;">
                            <canvas id="dualWaveform" width="600" height="100"></canvas>
                        </div>

                        <!-- Status -->
                        <div class="camera-status" id="dualStatus" style="margin-top: 10px;">
                            <span class="status-text">Sistema inactivo</span>
                        </div>

                        <!-- Controls -->
                        <div class="camera-controls">
                            <button id="startDualAuth" class="btn btn-primary">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M2 5a2 2 0 012-2h8a2 2 0 012 2v10a2 2 0 01-2 2H4a2 2 0 01-2-2V5zm12 0v10l4 2V3l-4 2z"/>
                                </svg>
                                Iniciar Sistema
                            </button>
                            <button id="captureDualBtn" class="btn btn-success" disabled>
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <circle cx="10" cy="10" r="8"/>
                                </svg>
                                Capturar y Autenticar
                            </button>
                            <button id="stopDualAuth" class="btn btn-secondary" style="display: none;">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <rect width="20" height="20" rx="2"/>
                                </svg>
                                Detener
                            </button>
                        </div>

                        <!-- Result Card -->
                        <div class="result-card" id="dualResultCard" style="display: none; width: 100%; max-width: 640px; margin-top: 20px;">
                            <div id="dualResultContent"></div>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <!-- Footer Info -->
        <footer class="footer">
            <div class="info-card" id="faceInfo">
                <h4>üìä Reconocimiento Facial</h4>
                <ol>
                    <li>Activa la c√°mara web</li>
                    <li>Posiciona tu rostro en el cuadro gu√≠a</li>
                    <li>Captura la imagen</li>
                    <li>El sistema analizar√° tu rostro con FaceNet + CNN</li>
                </ol>
            </div>
            <div class="info-card" id="voiceInfo" style="display: none;">
                <h4>üé§ Reconocimiento de Voz</h4>
                <ol>
                    <li>Graba un audio de 3 segundos</li>
                    <li>Presiona autenticar</li>
                    <li>El sistema extraer√° embeddings con ECAPA-TDNN</li>
                    <li>El modelo MLP clasificar√° tu identidad</li>
                </ol>
            </div>
            <div class="info-card" id="dualInfo" style="display: none;">
                <h4>üîê Autenticaci√≥n Dual</h4>
                <ol>
                    <li>Inicia el sistema (C√°mara + Micr√≥fono)</li>
                    <li>Presiona "Capturar y Autenticar"</li>
                    <li>Se capturar√° tu rostro y 3 segundos de voz</li>
                    <li>Ambos deben coincidir para el acceso</li>
                </ol>
            </div>
            <div class="info-card">
                <h4>üîí Privacidad</h4>
                <p>Los datos biom√©tricos se procesan localmente y no se almacenan. Sistema basado en redes neuronales profundas.</p>
            </div>
        </footer>
    </div>

    <script src="{% static 'js/audio-recorder.js' %}"></script>
    <script src="{% static 'js/camera.js' %}"></script>
    <script src="{% static 'js/voice.js' %}"></script>
    <script src="{% static 'js/dual_auth.js' %}"></script>
    <script src="{% static 'js/tabs.js' %}"></script>
</body>
</html>
